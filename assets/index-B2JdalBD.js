import h from"phaser";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const m of a.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();const V={type:h.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"game-container",scale:{mode:h.Scale.RESIZE,autoCenter:h.Scale.CENTER_BOTH},scene:{preload:ee,create:te,update:se},physics:{default:"arcade",arcade:{gravity:{y:0}}}};let f,n,u,D,P,E,d,A,Y,T,$,X,G,g=0,c=1,l,O,e,x=0,w=0,C=0,S=0,z=!1;const K=document.getElementById("start-screen"),L=document.getElementById("instructions-screen"),F=document.getElementById("score-screen"),U=document.getElementById("sentinelMode"),Z=document.getElementById("dogeMode"),_=document.getElementById("instructions-text"),j=document.getElementById("startButton"),J=document.getElementById("score-title"),Q=document.getElementById("score-details"),M=document.getElementById("orientationOverlay");W()?(k(),window.addEventListener("resize",k),window.addEventListener("orientationchange",k)):M.style.display="none";U.addEventListener("click",()=>N("sentinel"));Z.addEventListener("click",()=>N("doge"));function N(t){n=t,K.style.display="none",L.style.display="flex",L.style.backgroundImage=n==="sentinel"?"url('/assets/sentinel-bg.png')":"url('/assets/doge-bg.png')",_.textContent=n==="sentinel"?"You’re a loyal agent protecting a vital cause! Drag field logs, briefs, and ledgers to the shredder before auditors strike. Drag decoy reports (green) to the printer to mislead them. Fail, and it’s Audit Bust!":"You’re a whistleblower fighting to expose corruption! Drag expense reports, emails, and ledgers to the scanner to build your case. Drag testimony (green) to the printer to gain support. Fail, and trust is lost!",j.onclick=()=>{L.style.display="none",f=new h.Game(V),document.querySelector("canvas").style.display="block",z=!0,k()}}function ee(){this.load.image("sentinel-bg","/assets/sentinel-bg.png"),this.load.image("doge-bg","/assets/doge-bg.png"),this.load.image("field-expense-logs","/assets/field-expense-logs.png"),this.load.image("operation-briefs","/assets/operation-briefs.png"),this.load.image("project-ledgers","/assets/project-ledgers.png"),this.load.image("decoy-reports","/assets/decoy-reports.png"),this.load.image("expense-reports","/assets/expense-reports.png"),this.load.image("emails","/assets/emails.png"),this.load.image("ledgers","/assets/ledgers.png"),this.load.image("testimony","/assets/testimony.png"),this.load.image("shredder","/assets/shredder.png"),this.load.image("scanner","/assets/scanner.png"),this.load.image("printer","/assets/printer.png"),this.load.on("filecomplete",t=>console.log(`Loaded ${t}`)),this.load.on("loaderror",t=>console.error(`Failed to load ${t.key}`))}function te(){e=Math.min(this.scale.width/1920,this.scale.height/1080),l=n==="sentinel"?0:100,g=0,c=1,x=0,w=0,C=0,S=0,G=this.add.image(0,0,n==="sentinel"?"sentinel-bg":"doge-bg").setOrigin(0,0).setDisplaySize(this.scale.width,this.scale.height).setDepth(0),X=this.add.rectangle(this.scale.width/2,45*e,this.scale.width,90*e,0,.8).setOrigin(.5,.5).setDepth(1),D=this.add.image(this.scale.width/2,this.scale.height-100*e,"shredder").setInteractive().setScale(e*1.5).setDepth(2),P=this.add.image(this.scale.width/2,this.scale.height-100*e,"scanner").setInteractive().setScale(e*1.5).setDepth(2),E=this.add.image(this.scale.width-100*e,this.scale.height-100*e,"printer").setInteractive().setScale(e*1.5).setDepth(2),D.visible=n==="sentinel",P.visible=n==="doge",E.visible=!0;const t=this.scale.width/2-100*e;A=this.add.rectangle(this.scale.width/2,90*e,t,20*e).setStrokeStyle(2,16777215).setOrigin(.5,0).setDepth(2),d=this.add.rectangle((this.scale.width-t)/2,90*e,t,20*e,65280).setOrigin(0,0).setDepth(2),Y=this.add.text(this.scale.width/2,20*e,n==="sentinel"?"Auditor's Suspicion":"Public Trust",{fontSize:`${20*Math.max(e,.7)}px`,color:"#fff",align:"center"}).setOrigin(.5,0).setDepth(2),v(this,0),T=this.add.text(this.scale.width-50*e,40,`Score: ${g}`,{fontSize:`${20*Math.max(e,.7)}px`,color:"#fff",align:"right"}).setOrigin(1,.5).setDepth(2),$=this.add.text(this.scale.width-50*e,70,`x${c}`,{fontSize:`${20*Math.max(e,.7)}px`,color:"#fff",align:"right"}).setOrigin(1,.5).setDepth(2),u=this.physics.add.group({depth:10}),this.input.on("drag",(i,s,o,r)=>{const a=50*e,m=this.scale.width-50*e,I=50*e,b=this.scale.height-50*e;s.x=h.Math.Clamp(o,a,m),s.y=h.Math.Clamp(r,I,b),s.timerCircle&&(s.timerCircle.x=s.x,s.timerCircle.y=s.y-60*e)}),this.input.on("dragend",(i,s)=>ie(this,i,s)),O=this.time.addEvent({delay:800,callback:ne,callbackScope:this,loop:!0}),this.time.addEvent({delay:1e3,callback:ae,callbackScope:this,loop:!0}),this.scale.on("resize",ce,this)}function se(){u&&u.children&&u.children.each(t=>{if(t.timer!==void 0&&(t.timer-=this.game.loop.delta/1e3,oe(t),t.timer<=0)){if(t.timerCircle.destroy(),t.destroy(),!t.getData("isBeneficial")){let i;switch(t.texture.key){case(n==="sentinel"?"field-expense-logs":"expense-reports"):i=n==="sentinel"?1:-1;break;case(n==="sentinel"?"operation-briefs":"emails"):i=n==="sentinel"?10:-10;break;case(n==="sentinel"?"project-ledgers":"ledgers"):i=n==="sentinel"?20:-20;break}v(this,i)}c=1,$.setText(`x${c}`)}})}function ie(t,i,s){if(!s||s.timer===void 0||s.timer<=0)return;const o=n==="sentinel"?D:P,r=E;s.getData("isBeneficial")?h.Geom.Intersects.RectangleToRectangle(s.getBounds(),r.getBounds())&&(s.timerCircle.destroy(),s.timer=void 0,g+=s.getData("points")*c,T.setText(`Score: ${g}`),v(t,n==="sentinel"?-25:25),c=Math.min(c+1,5),$.setText(`x${c}`),S++,s.destroy()):h.Geom.Intersects.RectangleToRectangle(s.getBounds(),o.getBounds())&&(s.timerCircle.destroy(),s.timer=void 0,g+=s.getData("points")*c,T.setText(`Score: ${g}`),v(t,0),c=Math.min(c+1,5),$.setText(`x${c}`),s.texture.key===(n==="sentinel"?"field-expense-logs":"expense-reports")?x++:s.texture.key===(n==="sentinel"?"operation-briefs":"emails")?w++:s.texture.key===(n==="sentinel"?"project-ledgers":"ledgers")&&C++,s.destroy())}function ne(){const t=100*e,i=this.scale.width-100*e,s=150*e,o=this.scale.height/2,r=h.Math.Between(t,i),a=h.Math.Between(s,o),m=n==="sentinel"?[{key:"field-expense-logs",points:10,meterChange:1,weight:50},{key:"operation-briefs",points:20,meterChange:10,weight:30},{key:"project-ledgers",points:50,meterChange:20,weight:20}]:[{key:"expense-reports",points:10,meterChange:1,weight:50},{key:"emails",points:20,meterChange:10,weight:30},{key:"ledgers",points:50,meterChange:20,weight:20}],I=n==="sentinel"&&l>30||n==="doge"&&l<70;let b=[...m];I&&b.push({key:n==="sentinel"?"decoy-reports":"testimony",points:100,meterChange:25,weight:10});const q=b.reduce((B,H)=>B+H.weight,0);let R=Math.random()*q,y;for(const B of b)if(R-=B.weight,R<=0){y=B;break}const p=u.create(r,a,y.key).setInteractive({draggable:!0}).setScale(e*1.5).setDepth(10).setData("points",y.points).setData("meterChange",y.meterChange).setData("isBeneficial",y.key==="decoy-reports"||y.key==="testimony");p.timer=3,p.timerCircle=re(this,p.x,p.y-60*e),p.originalX=p.x,p.originalY=p.y}function re(t,i,s){return t.add.graphics({x:i,y:s}).setDepth(10)}function oe(t){if(!t.timerCircle)return;const i=t.timer/3;t.timerCircle.clear(),t.timerCircle.lineStyle(8*e,16777215),t.timerCircle.beginPath(),t.timerCircle.arc(0,0,20*e,-Math.PI/2,2*Math.PI*i-Math.PI/2,!1),t.timerCircle.strokePath()}function v(t,i=0){l=l+i,l=h.Math.Clamp(l,0,100),d.scaleX=l/100,n==="sentinel"?l<=25?d.fillColor=65280:l<=50?d.fillColor=16776960:l<=75?d.fillColor=16753920:d.fillColor=16711680:l>75?d.fillColor=65280:l>50?d.fillColor=16776960:l>25?d.fillColor=16753920:d.fillColor=16711680,l===(n==="sentinel"?100:0)&&le(t)}function ae(t){O.delay=Math.max(O.delay-8,300)}function le(t){t.time.removeAllEvents(),u.children.each(o=>{o.timerCircle&&o.timerCircle.destroy()}),u.clear(!0),document.querySelector("canvas").style.display="none",F.style.display="flex",F.style.backgroundImage="url('/assets/summary-bg.png')",z=!1,J.textContent=n==="sentinel"?"Audit Bust!":"Trust Lost!";const i=n==="sentinel"?"Shredded":"Scanned",s=n==="sentinel"?"Decoy Reports":"Testimonies";Q.innerHTML=`
    <p>${i} ${n==="sentinel"?"Field Expense Logs":"Expense Reports"}: ${x} (${x*10} pts)</p>
    <p>${i} ${n==="sentinel"?"Operation Briefs":"Emails"}: ${w} (${w*20} pts)</p>
    <p>${i} ${n==="sentinel"?"Project Ledgers":"Ledgers"}: ${C} (${C*50} pts)</p>
    <p>Printed ${s}: ${S} (${S*100} pts)</p>
    <p>Base Total: ${x*10+w*20+C*50+S*100} pts</p>
    <p>Multiplier Bonus: ${g-(x*10+w*20+C*50+S*100)} pts</p>
    <p>Final Score: ${g}</p>
  `,t.game.destroy(!0)}function W(){return/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)}function k(){if(!W()){M.style.display="none";return}window.matchMedia("(orientation: portrait)").matches?(M.style.display="flex",f&&f.scene&&f.scene.pause("default")):(M.style.display="none",z&&f&&f.scene&&f.scene.resume("default"))}function ce(t){const i=t.width,s=t.height;e=Math.min(i/1920,s/1080),G.setDisplaySize(i,s),X.setPosition(i/2,45*e).setSize(i,90*e),D.setPosition(i/2,s-100*e).setScale(e*1.5),P.setPosition(i/2,s-100*e).setScale(e*1.5),E.setPosition(i-100*e,s-100*e).setScale(e*1.5);const o=i/2-100*e;A.setPosition(i/2,90*e).setSize(o,20*e),d.setPosition((i-o)/2,90*e).setSize(o,20*e),Y.setPosition(i/2,20*e).setStyle({fontSize:`${20*Math.max(e,.7)}px`}),T.setPosition(i-50*e,40).setStyle({fontSize:`${20*Math.max(e,.7)}px`}),$.setPosition(i-50*e,70).setStyle({fontSize:`${20*Math.max(e,.7)}px`})}
