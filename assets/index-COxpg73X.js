import p from"phaser";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&d(f)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function d(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const r={type:p.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"game-container",scene:{preload:H,create:V,update:K},physics:{default:"arcade",arcade:{gravity:{y:0}}}};let i,u,T,I,M,g,v,$,m=0,c=1,l,E,s,y=0,x=0,C=0,w=0;const X=document.getElementById("start-screen"),D=document.getElementById("instructions-screen"),L=document.getElementById("score-screen"),A=document.getElementById("sentinelMode"),G=document.getElementById("dogeMode"),z=document.getElementById("instructions-text"),N=document.getElementById("startButton"),q=document.getElementById("score-title"),W=document.getElementById("score-details");A.addEventListener("click",()=>P("sentinel"));G.addEventListener("click",()=>P("doge"));function P(e){i=e,X.style.display="none",D.style.display="flex",D.style.backgroundImage=i==="sentinel"?"url('/assets/sentinel-bg.png')":"url('/assets/doge-bg.png')",z.textContent=i==="sentinel"?"You’re a loyal agent protecting a vital cause! Drag field logs, briefs, and ledgers to the shredder before auditors strike. Drag decoy reports (green) to the printer to mislead them. Fail, and it’s Audit Bust!":"You’re a whistleblower fighting to expose corruption! Drag expense reports, emails, and ledgers to the scanner to build your case. Drag testimony (green) to the printer to gain support. Fail, and trust is lost!",N.onclick=()=>{D.style.display="none",new p.Game(r),document.querySelector("canvas").style.display="block"}}function H(){this.load.image("sentinel-bg","/assets/sentinel-bg.png"),this.load.image("doge-bg","/assets/doge-bg.png"),this.load.image("field-expense-logs","/assets/field-expense-logs.png"),this.load.image("operation-briefs","/assets/operation-briefs.png"),this.load.image("project-ledgers","/assets/project-ledgers.png"),this.load.image("decoy-reports","/assets/decoy-reports.png"),this.load.image("expense-reports","/assets/expense-reports.png"),this.load.image("emails","/assets/emails.png"),this.load.image("ledgers","/assets/ledgers.png"),this.load.image("testimony","/assets/testimony.png"),this.load.image("shredder","/assets/shredder.png"),this.load.image("scanner","/assets/scanner.png"),this.load.image("printer","/assets/printer.png"),this.load.on("filecomplete",e=>console.log(`Loaded ${e}`)),this.load.on("loaderror",e=>console.error(`Failed to load ${e.key}`))}function V(){s=Math.min(r.width/1920,r.height/1080),l=i==="sentinel"?0:100,m=0,c=1,y=0,x=0,C=0,w=0,this.add.image(0,0,i==="sentinel"?"sentinel-bg":"doge-bg").setOrigin(0,0).setDisplaySize(r.width,r.height).setDepth(0),this.add.rectangle(r.width/2,45*s,r.width,150*s,0,.8).setOrigin(.5,.5).setDepth(1),T=this.add.image(r.width/2,r.height-100*s,"shredder").setInteractive().setScale(s*1.5).setDepth(2),I=this.add.image(r.width/2,r.height-100*s,"scanner").setInteractive().setScale(s*1.5).setDepth(2),M=this.add.image(r.width-100*s,r.height-100*s,"printer").setInteractive().setScale(s*1.5).setDepth(2),T.visible=i==="sentinel",I.visible=i==="doge",M.visible=!0;const e=r.width/2-100*s;this.add.rectangle(r.width/2,90*s,e,20*s).setStrokeStyle(2,16777215).setOrigin(.5,0).setDepth(2),g=this.add.rectangle((r.width-e)/2,90*s,e,20*s,65280).setOrigin(0,0).setDepth(2),this.add.text(r.width/2,20*s,i==="sentinel"?"Auditor's Suspicion":"Public Trust",{fontSize:`${20*Math.max(s,.7)}px`,color:"#fff",align:"center"}).setOrigin(.5,0).setDepth(2),B(this,0),v=this.add.text(r.width-50*s,40,`Score: ${m}`,{fontSize:`${20*Math.max(s,.7)}px`,color:"#fff",align:"right"}).setOrigin(1,.5).setDepth(2),$=this.add.text(r.width-50*s,70,`x${c}`,{fontSize:`${20*Math.max(s,.7)}px`,color:"#fff",align:"right"}).setOrigin(1,.5).setDepth(2),u=this.physics.add.group({depth:2}),this.input.on("drag",(n,t,d,o)=>{const a=50*s,f=r.width-50*s,k=50*s,S=r.height-50*s;t.x=p.Math.Clamp(d,a,f),t.y=p.Math.Clamp(o,k,S),t.timerCircle&&(t.timerCircle.x=t.x,t.timerCircle.y=t.y-60*s)}),this.input.on("dragend",(n,t)=>U(this,n,t)),E=this.time.addEvent({delay:800,callback:j,callbackScope:this,loop:!0}),this.time.addEvent({delay:1e3,callback:Z,callbackScope:this,loop:!0})}function K(){u&&u.children&&u.children.each(e=>{if(e.timer!==void 0&&(e.timer-=this.game.loop.delta/1e3,Q(e),e.timer<=0)){if(e.timerCircle.destroy(),e.destroy(),!e.getData("isBeneficial")){let n;switch(e.texture.key){case(i==="sentinel"?"field-expense-logs":"expense-reports"):n=i==="sentinel"?1:-1;break;case(i==="sentinel"?"operation-briefs":"emails"):n=i==="sentinel"?10:-10;break;case(i==="sentinel"?"project-ledgers":"ledgers"):n=i==="sentinel"?20:-20;break}B(this,n)}c=1,$.setText(`x${c}`)}})}function U(e,n,t){if(!t||t.timer===void 0||t.timer<=0)return;const d=i==="sentinel"?T:I,o=M;t.getData("isBeneficial")?p.Geom.Intersects.RectangleToRectangle(t.getBounds(),o.getBounds())&&(t.timerCircle.destroy(),t.timer=void 0,m+=t.getData("points")*c,v.setText(`Score: ${m}`),B(e,i==="sentinel"?-5:5),c=Math.min(c+1,5),$.setText(`x${c}`),w++,t.destroy()):p.Geom.Intersects.RectangleToRectangle(t.getBounds(),d.getBounds())&&(t.timerCircle.destroy(),t.timer=void 0,m+=t.getData("points")*c,v.setText(`Score: ${m}`),B(e,0),c=Math.min(c+1,5),$.setText(`x${c}`),t.texture.key===(i==="sentinel"?"field-expense-logs":"expense-reports")?y++:t.texture.key===(i==="sentinel"?"operation-briefs":"emails")?x++:t.texture.key===(i==="sentinel"?"project-ledgers":"ledgers")&&C++,t.destroy())}function j(){const e=i==="sentinel"?[{key:"field-expense-logs",points:10,meterChange:1,weight:50},{key:"operation-briefs",points:20,meterChange:10,weight:30},{key:"project-ledgers",points:50,meterChange:20,weight:20}]:[{key:"expense-reports",points:10,meterChange:1,weight:50},{key:"emails",points:20,meterChange:10,weight:30},{key:"ledgers",points:50,meterChange:20,weight:20}],n=i==="sentinel"&&l>30||i==="doge"&&l<70;let t=[...e];n&&t.push({key:i==="sentinel"?"decoy-reports":"testimony",points:100,meterChange:5,weight:10});const d=t.reduce((b,Y)=>b+Y.weight,0);let o=Math.random()*d,a;for(const b of t)if(o-=b.weight,o<=0){a=b;break}const f=100*s,k=r.width-100*s,S=150*s,F=r.height/2,O=p.Math.Between(f,k),R=p.Math.Between(S,F),h=u.create(O,R,a.key).setInteractive({draggable:!0}).setScale(s*1.5).setData("points",a.points).setData("meterChange",a.meterChange).setData("isBeneficial",a.key==="decoy-reports"||a.key==="testimony");h.timer=3,h.timerCircle=J(this,h.x,h.y-60*s),h.originalX=h.x,h.originalY=h.y}function J(e,n,t){return e.add.graphics({x:n,y:t}).setDepth(2)}function Q(e){if(!e.timerCircle)return;const n=e.timer/3;e.timerCircle.clear(),e.timerCircle.lineStyle(8*s,16777215),e.timerCircle.beginPath(),e.timerCircle.arc(0,0,20*s,-Math.PI/2,2*Math.PI*n-Math.PI/2,!1),e.timerCircle.strokePath()}function B(e,n=0){l=l+n,l=p.Math.Clamp(l,0,100),g.scaleX=l/100,i==="sentinel"?l<=25?g.fillColor=65280:l<=50?g.fillColor=16776960:l<=75?g.fillColor=16753920:g.fillColor=16711680:l>75?g.fillColor=65280:l>50?g.fillColor=16776960:l>25?g.fillColor=16753920:g.fillColor=16711680,l===(i==="sentinel"?100:0)&&_(e)}function Z(e){E.delay=Math.max(E.delay-8,300)}function _(e){e.time.removeAllEvents(),u.children.each(d=>{d.timerCircle&&d.timerCircle.destroy()}),u.clear(!0),document.querySelector("canvas").style.display="none",L.style.display="flex",L.style.backgroundImage="url('/assets/summary-bg.png')",q.textContent=i==="sentinel"?"Audit Bust!":"Trust Lost!";const n=i==="sentinel"?"Shredded":"Scanned",t=i==="sentinel"?"Decoy Reports":"Testimonies";W.innerHTML=`
    <p>${n} ${i==="sentinel"?"Field Expense Logs":"Expense Reports"}: ${y} (${y*10} pts)</p>
    <p>${n} ${i==="sentinel"?"Operation Briefs":"Emails"}: ${x} (${x*20} pts)</p>
    <p>${n} ${i==="sentinel"?"Project Ledgers":"Ledgers"}: ${C} (${C*50} pts)</p>
    <p>Printed ${t}: ${w} (${w*100} pts)</p>
    <p>Base Total: ${y*10+x*20+C*50+w*100} pts</p>
    <p>Multiplier Bonus: ${m-(y*10+x*20+C*50+w*100)} pts</p>
    <p>Final Score: ${m}</p>
  `,e.game.destroy(!0)}
